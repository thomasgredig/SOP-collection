<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>parkafm – SOP</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bd63a85aa89f700c731407e261dd04a2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">SOP</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Gredig Lab: SOP Collection</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../instruments/01-ParkAFM.html" aria-current="page"> 
<span class="menu-text">Park AFM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../instruments/02-EMS575-Sputtering.html"> 
<span class="menu-text">EMS 575 Sputter Coater</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../instruments/03-PE25-Plasma-Etcher.html"> 
<span class="menu-text">Plasma Etcher</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../instruments/04-XRD-Rigaku-X-Ray-Diffractometer.html"> 
<span class="menu-text">Rigaku XRD</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../instruments/05-CypherAFM.html"> 
<span class="menu-text">Cypher AFM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../instruments/06-Photospectrometer.html"> 
<span class="menu-text">UH 4150</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../instruments/08-ATE-Angstrom-Thermal-Evaporator.html"> 
<span class="menu-text">AE Thermal Evaporator</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#park-afm" id="toc-park-afm" class="nav-link active" data-scroll-target="#park-afm">Park AFM</a>
  <ul class="collapse">
  <li><a href="#warnings" id="toc-warnings" class="nav-link" data-scroll-target="#warnings">Warnings</a></li>
  <li><a href="#system-start-up" id="toc-system-start-up" class="nav-link" data-scroll-target="#system-start-up">System Start-Up</a></li>
  <li><a href="#sample-preparation" id="toc-sample-preparation" class="nav-link" data-scroll-target="#sample-preparation">Sample Preparation</a></li>
  <li><a href="#engaging-sample" id="toc-engaging-sample" class="nav-link" data-scroll-target="#engaging-sample">Engaging Sample</a></li>
  <li><a href="#non-contact-mode-imaging" id="toc-non-contact-mode-imaging" class="nav-link" data-scroll-target="#non-contact-mode-imaging">Non-Contact Mode Imaging</a></li>
  <li><a href="#lift-procedure" id="toc-lift-procedure" class="nav-link" data-scroll-target="#lift-procedure">Lift Procedure</a></li>
  <li><a href="#finishing-measurements" id="toc-finishing-measurements" class="nav-link" data-scroll-target="#finishing-measurements">Finishing Measurements</a></li>
  <li><a href="#cantilever-replacement" id="toc-cantilever-replacement" class="nav-link" data-scroll-target="#cantilever-replacement">Cantilever Replacement</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<section id="park-afm" class="level1">
<h1>Park AFM</h1>
<section id="warnings" class="level2">
<h2 class="anchored" data-anchor-id="warnings">Warnings</h2>
<ul>
<li><p><strong>Protect the optics by manually raising the objectives.</strong> The computer control does not sense the objective position and could ram the z-stage into the objective.</p></li>
<li><p><strong>Protect the lock mechanism of the focus.</strong></p></li>
<li><p><strong>Before the AFM head is mounted or unmounted from the Z stage, the ON/OFF switch for the laser beam must be turned off. Otherwise, the laser beam diode in the AFM head may be damaged.</strong></p></li>
<li><p><strong>When the AFM head is mounted or unmounted from the Z stage, ensure that the AFM head does not sustain any damage, and that it is properly grounded. The AFM head is extremely sensitive to electrostatic discharge.</strong></p></li>
<li><p><strong>The superluminescent photodiode is 830nm, infrared, so invisible.</strong> If you lose the photodiode position, it is difficult to find the spot, since the <a href="https://parksystems.com/park-spm-modes/91-standard-imaging-mode/223-basic-contact-afm-dynamic-force-microscope-dfm">wavelength is mostly infrared</a>. Adjust the x-y position of the photodiode only in small increments.</p></li>
</ul>
</section>
<section id="system-start-up" class="level2">
<h2 class="anchored" data-anchor-id="system-start-up">System Start-Up</h2>
<ol type="1">
<li>Carefully review all warnings attached to the side of the AFM box.</li>
<li>Sign-in to the logbook and read previous status.</li>
<li>Turn on the computer.</li>
<li>Turn on the Park XE AFM Controller. See image below. v</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.10.59.png" class="img-fluid figure-img"></p>
<figcaption>AFM controller</figcaption>
</figure>
</div>
</section>
<section id="sample-preparation" class="level2">
<h2 class="anchored" data-anchor-id="sample-preparation">Sample Preparation</h2>
<ol type="1">
<li>Use a magnetic sample holder disc and mount your sample to it using double-sided carbon tape.
<ol type="a">
<li>NOTE: You should touch your glove to the tape to reduce the stickiness of the surface allowing you to remove the sample without issue later.</li>
</ol></li>
<li>Open the AFM isolation chamber and place the holder onto the sample stage.
<ol type="a">
<li>WARNING: The sample stage is magnetic. You should approach the stage with the holder from the side and slide it into place. Approaching from above the stage will cause the magnetic forces to “grab” the holder, crashing it into the surface, which can <strong>cause damage to the piezo-electric xy stage</strong>.</li>
</ol></li>
<li>Turn on the Activation Table by pressing the power button on the right-side of the table. You should see the table front panel light up when it is on. See image below.</li>
<li>Set the Activation Table’s mode to ACTIVE by pressing the state button on the left-side of the table. The LED should change from “LOCK” to “ACT”. See image below.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.11.11.png" class="img-fluid figure-img"></p>
<figcaption>Activation Table</figcaption>
</figure>
</div>
</section>
<section id="engaging-sample" class="level2">
<h2 class="anchored" data-anchor-id="engaging-sample">Engaging Sample</h2>
<ol type="1">
<li>Launch the <code>Smart Scan</code> program and wait for the initialization process to finish.</li>
<li>Adjust the focus of the objective lens so it is focused on the cantilever. See image below.
<ul>
<li>To adjust the focus of the objective lens you must to hold the focus wheel and unlock it by moving the lever on the wheel back. It can be lowered by turning the wheel counter-clockwise.
<ul>
<li><strong>WARNING: ALWAYS unlock the focus wheel,</strong> before moving it, and then hold the focus wheel when making adjustments as it will freely fall under the weight of the objective lens. Failing to unlock, may break the objective mechanism and hold the wheel as it will move under gravity.</li>
<li>You can determine when the cantilever is in focus by viewing the computer screen as you lower the objective.</li>
</ul></li>
<li>Once the cantilever is in focus, lock the focus wheel by moving to lock lever toward you.
<ul>
<li>Do not over-tighten the lever but ensure it is a good position by making sure the objective maintains focus after it has been locked and you are no longer holding the wheel.</li>
<li>It is a common issue that the objective motional stage breaks, if not properly used.</li>
</ul></li>
</ul></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.11.21.png" class="img-fluid figure-img"></p>
<figcaption>Optics</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li><p><strong>The photodiode is 830nm, so infrared and therefore invisible.</strong> It is hard to locate the photodiode light beam, once you lose</p></li>
<li><p>The photodiode beam can be seen in the software by looking at the cantilever. There will be a bright spot when the beam is on the cantilever. You can move the position of the beam by adjusting the dials on top of the z-stage. See image below.</p></li>
</ol>
<ul>
<li>The beam should be positioned near the tip of the cantilever. Adjust the position of the beam until the “Intensity (A+B)” reading is maximized (approx. 3 V)</li>
</ul>
<ol start="4" type="1">
<li><p>The detector position is visualized in the software as a crosshair with a red/green dot with readings of the vertical/lateral position of the detector. It needs to be aligned so the dot in the crosshair is green. Adjust the position of the detector by adjusting the dials on the front of the z-stage. See image below.</p>
<ul>
<li>By turning the dials on the front of the z-stage the dot on the crosshair will move left/right and up/down. Adjust the position of the detector until the “Vertical (A-B)” and “Lateral (C-D)” readings are minimized (less than 0.100 V is ideal)</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.11.27.png" class="img-fluid figure-img"></p>
<figcaption>Photodiode and Detector Adjustments</figcaption>
</figure>
</div></li>
<li><p>In the “Smart Scan” software click on the “Auto” tab in the top-right. <strong>Make sure that the green light for the centered diode beam is ON</strong>, then select the “Position” icon on the left-side of the screen. (If the LED is red, you need to align the photodiode beam first.) This will begin the process of measuring the cantilever’s resonant frequency. The resonance frequency and Q-factor must be recorded in the logbook.</p>
<ul>
<li>The AFM will then begin to approach the sample so the tip is engaged with the surface of the sample. Wait for this process to complete before proceeding. (It may take a minute or so.)</li>
</ul></li>
<li><p>Once the auto-engage process is finished, adjust the focus of the objective so it is focused on the sample’s surface. The cantilever should be close to the surface now.</p></li>
<li><p>Close and lock the door so noise vibrations do not interfere with imaging.</p></li>
</ol>
</section>
<section id="non-contact-mode-imaging" class="level2">
<h2 class="anchored" data-anchor-id="non-contact-mode-imaging">Non-Contact Mode Imaging</h2>
<ol type="1">
<li>Ensure Non-Contact Mode <code>NCM</code> is set for the scan. This is done by selecting NCM from the Head mode list next to the “Setup” tab in the SmartScan software. See image below.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.11.33.png" class="img-fluid figure-img"></p>
<figcaption>Non contact mode imaging</figcaption>
</figure>
</div>
<p>WARNING: If you need to move to a different area of your sample for a scan see the “Lift Procedure” section for instructions. Attempting to move the sample without following the lift procedure will break the cantilever.</p>
<ol start="2" type="1">
<li>You can capture an image by selecting the “Image” icon on the left-side of the screen.</li>
<li>Adjust the parameters for your scan as needed and determine an appropriate location for files to be saved once the scan is complete.</li>
<li>Once the scan is complete, you can redefine a new area by adjusting the scan window in the application or defining new scan area parameters.
<ul>
<li>NOTE: Your scan area should be a power of 2 and <em>must be square.</em></li>
<li>Ex: 128 x 128, 256 x 256, 512 x 512, etc.</li>
<li>Scan areas “snap” to a grid defined by the software when moving them. You can make fine adjustments to the scan area window by using the “Offset” parameter.</li>
</ul></li>
<li>You can use <code>Park XEI software</code> to analyze your images on Windows systems. <a href="http://gwyddion.net/">Gwyddion</a> can be used for Mac OS systems.</li>
</ol>
</section>
<section id="lift-procedure" class="level2">
<h2 class="anchored" data-anchor-id="lift-procedure">Lift Procedure</h2>
<p>To move to a different area of your sample you need to “lift” the tip away from the surface sufficiently far enough above the surface so the cantilever easily clears the height of all features on your sample.</p>
<ol type="1">
<li>Defining the distance the tip should be raised and clicking the “Lift” button will disengage the tip from the sample’s surface. Lifting in intervals of 50 um is typically fine.
<ul>
<li><strong>CAUTION: The objective is very close to the z-stage during scanning.</strong> Using a large value for the lift may cause the z-stage to crash into the objective lens, damaging it. A lift of 100 um is usually fine but make sure you are aware of your sample’s expected feature height to determine an appropriate lift height above the surface. If there is any doubt, it is best to first move the objective up by unlocking the focus wheel and turning it clockwise (away from you) to prevent the z-stage from crashing into the objective. Refocus on the sample once the lift is complete.</li>
</ul></li>
<li>Moving the sample can be done by adjusting the dials on the sample stage. They will move the stage forward/back and left/right. See image below.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.11.41.png" class="img-fluid figure-img"></p>
<figcaption>AFM controller</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li>After repositioning your sample, click on the “Auto” tab and select the “Position” icon to re-engage the tip to the sample’s surface. This will perform a new scan of the cantilever to determine the resonant frequency and intensity which should be recorded in the logbook.</li>
<li>Scanning can be performed following instructions in the “Imaging the Sample” section above.</li>
</ol>
</section>
<section id="finishing-measurements" class="level2">
<h2 class="anchored" data-anchor-id="finishing-measurements">Finishing Measurements</h2>
<ol type="1">
<li>Unlock the objective (push lever back), then move the objective to the top position and lock back (pull forward).</li>
<li>Perform a lift from the surface to disengage the tip. Typically a lift of 100 um is sufficient to clear all features.</li>
<li>Click the “End” icon on the left-side of the screen to automatically raise the z-stage away from the sample. A manual lift can be performed but it is best to select the “Lift z all” option to provide the largest clearance between the z-stage and sample, allowing for easier loading/unloading of samples.</li>
<li>Remove the sample holder from the sample stage by sliding it horizontally across the surface until it is no longer held by the magnet.</li>
<li>Return the Activation Table to the “Lock” state by pressing the button on the front left-side of the table, <strong>wait until it is locked, will take about 30 seconds</strong>, ONLY THEN turn it off by pressing the button on the front right-side. If the setup is used again, the next day, the activation table can be left on in the locked position.</li>
</ol>
</section>
<section id="cantilever-replacement" class="level2">
<h2 class="anchored" data-anchor-id="cantilever-replacement">Cantilever Replacement</h2>
<ol type="1">
<li><p><strong>IMPORTANT:</strong> Turn OFF the photodiode.</p></li>
<li><p>Ensure the objective is in its highest position.</p></li>
<li><p>Ensure all LEDs are off, ONLY THEN disconnect the cable on the left-side of the z-stage and move the paddles securing it to the instrument to the “in” position. The paddles are located at the top of the z-stage mounting rails. See image below.</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.11.50.png" class="img-fluid figure-img"></p>
<figcaption>AFM controller</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li>The z-stage is heavy. Carefully slide the z-stage to the right, avoiding the objective, until it is off the mounting rails. See image above.</li>
<li>Place it in the stand as shown in the image below.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.11.57.png" class="img-fluid figure-img"></p>
<figcaption>AFM controller</figcaption>
</figure>
</div>
<ol start="5" type="1">
<li><p>The cantilever can be removed by carefully lifting it up off of the two pins holding it in place. Place the removed cantilever in the appropriate slot of the replacements case.</p></li>
<li><p>Remove a new cantilever from the case, record the new cantilever’s ID in the log book, and attach it to the z-stage by aligning the pins to the cantilever’s slots. You will need to carefully attach it onto the z-stage until it softly clicks into place. See images below.</p></li>
</ol>
<ul>
<li>CAUTION: The cantilever is extremely delicate. Avoid getting the tip to touch any surface or anything.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/images/parkAFM_16.12.02.png" class="img-fluid figure-img"></p>
<figcaption>AFM controller</figcaption>
</figure>
</div>
<ol start="7" type="1">
<li>Slide the z-stage back into its place on the instrument, careful to avoid hitting the objective.</li>
</ol>
<ul>
<li>Slide it all the way to the left, until it cannot be moved anymore.</li>
</ul>
<ol start="8" type="1">
<li><p>Lock the z-stage in place by moving the paddles to the “out” position.</p></li>
<li><p>Connect the cable to the left side of the z-stage.</p></li>
<li><p>Focus on the cantilever tip and adjust laser according to previous section.</p></li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>